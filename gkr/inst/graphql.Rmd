---
title: "graphql"
output: html_document
---


```{r}
library(jsonlite)
library(dplyr)
library(purrr)
```

```{r}
q_description <- read_schema("description")
```


```{r}
desc_query <- ghql_query(q_description, name = "logrrr", owner = "metrumresearchgroup", branchfile = "master:DESCRIPTION")
str(desc_query$data)
```

```{r}
jc_query = ghql_query(q_description, name="r-basics", owner="dreznel", branchfile = "master:DESCRIPTION")
jc_query
jc_query = ghql_query(q_description, name="r-basics", owner="dreznel", branchfile = "test-branch2:hello.R")
```

```{r}
source("../R/make-branch.R")
# update_description_file(
    # repository_owner,
  # repository,
  # path = './DESCRIPTION',
  # commit_message,
  # b64_content,
  # file_sha,
  # branch
# )
update_description_file(
  repository_owner = "dreznel",
  repository = "r-basics",
  commit_message = "AUTO: IT WORKED! Again!",
  b64_content = jsonlite::base64_enc("Cats and Oranges and Dogs and Peaches"),
  file_sha = "8dd7c2de72654f78cd40aad982e824b9deba0b08",
  branch = "test-branch1"
)
```
```{r}
source("../R/make-branch.R")
# create_pull_request <- function(
#   repository_owner,
#   repository,
#   title,
#   description = "",
#   branch_to_give,
#   branch_to_receive
# ) 
response <- create_pull_request("dreznel", "r-basics", "AUTO PULL REQUEST", "THIS WAS AUTOGENERATED HOW NEAT", "test-branch3", "master")
```

```{r}
source("../R/branching_functions.R")
gql_response = ghql_query(q_description, name="r-basics", owner="dreznel", branchfile = "master:DESCRIPTION")
branch_oid <- gql_response$data$repository$ref$target$oid
file_oid <- gql_response$data$repository$object$oid
branch_name <- "test-branch6"
content = jsonlite::base64_enc("Cats and Oranges and Dogs and Peaches")
make_branch(user = "dreznel", repository = "r-basics", branch_name = branch_name, branch_oid)
update_description_file(repository_owner = "dreznel", repository = "r-basics", b64_content = content, file_sha = file_oid, branch = branch_name)
create_pull_request("dreznel", "r-basics", branch_name)
```
